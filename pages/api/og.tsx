import { ImageResponse } from '@vercel/og';
import { NextRequest } from 'next/server';

export const config = {
    runtime: 'edge',
  };
  
  export default function (req: NextRequest) {
    try {
      const { searchParams } = new URL(req.url);
  
      // ?title=<title>
      const hasTitle = searchParams.has('title');
      const title = hasTitle
        ? searchParams.get('title')?.slice(0, 100)
        : 'My Store';
  
      return new ImageResponse(
        (
          <div
            style={{
              backgroundColor: 'black',
              backgroundSize: '150px 150px',
              height: '100%',
              width: '100%',
              display: 'flex',
              textAlign: 'center',
              alignItems: 'center',
              justifyContent: 'center',
              flexDirection: 'column',
              flexWrap: 'nowrap',
            }}
          >
            <div
              style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                justifyItems: 'center',
              }}
            >
              <svg
                viewBox="0 0 238 60"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path fill="white" d="M90.8025 42.0825V37.5225C90.6505 37.9975 90.204 38.653 89.463 39.489C88.741 40.325 87.7435 41.085 86.4705 41.769C85.2165 42.434 83.7345 42.7665 82.0245 42.7665C79.8585 42.7665 77.892 42.2535 76.125 41.2275C74.377 40.2015 72.9805 38.767 71.9355 36.924C70.9095 35.062 70.3965 32.8865 70.3965 30.3975C70.3965 27.9085 70.9095 25.7425 71.9355 23.8995C72.9805 22.0375 74.377 20.5935 76.125 19.5675C77.892 18.5225 79.8585 18 82.0245 18C83.7155 18 85.1785 18.304 86.4135 18.912C87.6675 19.52 88.665 20.223 89.406 21.021C90.166 21.819 90.6125 22.503 90.7455 23.073V18.684H95.6475V42.0825H90.8025ZM75.2985 30.3975C75.2985 32.0885 75.669 33.5515 76.41 34.7865C77.151 36.0215 78.1105 36.981 79.2885 37.665C80.4855 38.33 81.7585 38.6625 83.1075 38.6625C84.5515 38.6625 85.8435 38.3205 86.9835 37.6365C88.1235 36.9525 89.026 35.993 89.691 34.758C90.356 33.504 90.6885 32.0505 90.6885 30.3975C90.6885 28.7445 90.356 27.3005 89.691 26.0655C89.026 24.8115 88.1235 23.8425 86.9835 23.1585C85.8435 22.4555 84.5515 22.104 83.1075 22.104C81.7585 22.104 80.4855 22.446 79.2885 23.13C78.1105 23.814 77.151 24.7735 76.41 26.0085C75.669 27.2435 75.2985 28.7065 75.2985 30.3975Z" />
                <path fill="white" d="M134.336 18C136.065 18 137.547 18.38 138.782 19.14C140.017 19.881 140.958 21.021 141.604 22.56C142.269 24.099 142.601 26.0655 142.601 28.4595V42.0825H137.699V29.457C137.699 26.93 137.348 25.03 136.645 23.757C135.942 22.484 134.659 21.8475 132.797 21.8475C131.809 21.8475 130.859 22.123 129.947 22.674C129.054 23.206 128.313 24.0325 127.724 25.1535C127.154 26.2745 126.869 27.709 126.869 29.457V42.0825H122.252V29.457C122.252 26.93 121.815 25.03 120.941 23.757C120.067 22.484 118.842 21.8475 117.265 21.8475C116.258 21.8475 115.308 22.1135 114.415 22.6455C113.541 23.1585 112.828 23.9755 112.277 25.0965C111.726 26.2175 111.451 27.671 111.451 29.457V42.0825H106.52V18.684H111.451V22.275C111.66 21.686 112.106 21.059 112.79 20.394C113.493 19.729 114.386 19.1685 115.469 18.7125C116.571 18.2375 117.797 18 119.146 18C120.552 18 121.73 18.285 122.68 18.855C123.63 19.425 124.38 20.128 124.931 20.964C125.482 21.781 125.862 22.5695 126.071 23.3295C126.337 22.5125 126.85 21.6955 127.61 20.8785C128.37 20.0425 129.33 19.3585 130.489 18.8265C131.648 18.2755 132.93 18 134.336 18Z" />
                <path fill="white" d="M172.259 42.0825V37.5225C172.107 37.9975 171.661 38.653 170.92 39.489C170.198 40.325 169.2 41.085 167.927 41.769C166.673 42.434 165.191 42.7665 163.481 42.7665C161.315 42.7665 159.349 42.2535 157.582 41.2275C155.834 40.2015 154.437 38.767 153.392 36.924C152.366 35.062 151.853 32.8865 151.853 30.3975C151.853 27.9085 152.366 25.7425 153.392 23.8995C154.437 22.0375 155.834 20.5935 157.582 19.5675C159.349 18.5225 161.315 18 163.481 18C165.172 18 166.635 18.304 167.87 18.912C169.124 19.52 170.122 20.223 170.863 21.021C171.623 21.819 172.069 22.503 172.202 23.073V18.684H177.104V42.0825H172.259ZM156.755 30.3975C156.755 32.0885 157.126 33.5515 157.867 34.7865C158.608 36.0215 159.567 36.981 160.745 37.665C161.942 38.33 163.215 38.6625 164.564 38.6625C166.008 38.6625 167.3 38.3205 168.44 37.6365C169.58 36.9525 170.483 35.993 171.148 34.758C171.813 33.504 172.145 32.0505 172.145 30.3975C172.145 28.7445 171.813 27.3005 171.148 26.0655C170.483 24.8115 169.58 23.8425 168.44 23.1585C167.3 22.4555 166.008 22.104 164.564 22.104C163.215 22.104 161.942 22.446 160.745 23.13C159.567 23.814 158.608 24.7735 157.867 26.0085C157.126 27.2435 156.755 28.7065 156.755 30.3975Z" />
                <path fill="white" d="M186.808 18.684H207.214L193.221 38.3205H206.644V42.0825H185.212L199.206 22.4175H186.808V18.684Z" />
                <path fill="white" d="M218.808 31.395C218.827 32.801 219.131 34.0835 219.72 35.2425C220.309 36.4015 221.183 37.323 222.342 38.007C223.52 38.691 224.964 39.033 226.674 39.033C228.118 39.033 229.344 38.824 230.351 38.406C231.377 37.969 232.213 37.456 232.859 36.867C233.505 36.259 233.97 35.7175 234.255 35.2425L236.678 38.235C236.051 39.147 235.281 39.945 234.369 40.629C233.476 41.313 232.384 41.8355 231.092 42.1965C229.8 42.5765 228.223 42.7665 226.361 42.7665C223.853 42.7665 221.677 42.2345 219.834 41.1705C218.01 40.0875 216.604 38.596 215.616 36.696C214.628 34.777 214.134 32.5825 214.134 30.1125C214.134 27.8325 214.6 25.7805 215.531 23.9565C216.462 22.1135 217.811 20.66 219.578 19.596C221.364 18.532 223.511 18 226.019 18C228.318 18 230.313 18.4845 232.004 19.4535C233.714 20.4035 235.034 21.7525 235.965 23.5005C236.915 25.2485 237.39 27.3385 237.39 29.7705C237.39 29.9225 237.381 30.198 237.362 30.597C237.343 30.977 237.324 31.243 237.305 31.395H218.808ZM232.659 27.6615C232.64 26.8825 232.412 26.0275 231.975 25.0965C231.557 24.1655 230.873 23.3675 229.923 22.7025C228.973 22.0375 227.691 21.705 226.076 21.705C224.404 21.705 223.055 22.028 222.029 22.674C221.022 23.32 220.281 24.1085 219.806 25.0395C219.331 25.9515 219.055 26.8255 218.979 27.6615H232.659Z" />
                <path fill="white" d="M44.1705 34.5398H44.1905L40.3505 27.8698C39.7705 26.8698 38.6005 26.0398 37.3605 25.7798L37.2505 25.7598C35.8905 25.5098 34.6605 25.9498 33.7505 27.1698L33.6805 27.2598L33.5305 27.4798L33.4005 27.6698L33.2105 27.9498L33.0005 28.2698L32.7105 28.7198L32.3305 29.3298L31.8105 30.1698H31.8205L36.6605 38.8998C37.8705 40.9798 40.5105 41.6898 42.5905 40.4798C44.6405 39.2898 45.3605 36.6998 44.2305 34.6398L44.1805 34.5498L44.1705 34.5398Z" />
                <path fill="white" d="M37.3803 22.9197L37.5003 22.9397L34.1503 17.1297C33.1803 15.4697 31.9403 14.6397 30.1303 14.6097H30.0103C28.3103 14.6097 26.8603 15.4797 25.9403 17.0297L25.8803 17.1297L15.8303 34.5397C14.6203 36.6197 15.3303 39.2597 17.4203 40.4697C19.4703 41.6597 22.0703 40.9897 23.3003 38.9797L24.3603 37.1597L25.2303 35.6697L25.8603 34.5997L26.4803 33.5497L27.0903 32.5197L27.8203 31.2997L28.3003 30.4997L29.0103 29.3297L29.5803 28.4097L29.8803 27.9297L30.3003 27.2697L30.5603 26.8697L30.6803 26.6797L30.9103 26.3397L31.1203 26.0297L31.2603 25.8197L31.3503 25.6897L31.5103 25.4697C33.0103 23.4897 35.1503 22.6397 37.4003 22.9297L37.3803 22.9197Z" />
                <path fill="white" d="M30 -0.000244141C13.43 -0.000244141 0 13.4298 0 29.9998C0 46.5698 13.43 59.9998 30 59.9998C46.57 59.9998 60 46.5698 60 29.9998C60 13.4298 46.57 -0.000244141 30 -0.000244141ZM43.99 42.9098C40.6 44.8798 36.28 43.7498 34.25 40.3798L34.19 40.2798L30.11 32.9198L30.01 33.0898L29.18 34.4798L28.87 34.9998L27.94 36.5798L27.32 37.6498L26.21 39.5598L25.77 40.3298C23.78 43.7598 19.41 44.9298 15.99 42.9398C12.6 40.9698 11.42 36.6698 13.32 33.2598L13.38 33.1598L23.44 15.7298C24.84 13.2698 27.24 11.7998 30.02 11.7998C32.8 11.7998 35.05 13.1498 36.52 15.5998L36.59 15.7298L46.64 33.1398H46.62L46.67 33.2398C48.57 36.6498 47.4 40.9498 44 42.9198L43.99 42.9098Z" />
              </svg>
            </div>
            <div
              style={{
                fontSize: 60,
                fontStyle: 'normal',
                letterSpacing: '-0.025em',
                color: 'white',
                marginTop: 30,
                padding: '0 120px',
                lineHeight: 1.4,
                whiteSpace: 'pre-wrap',
              }}
            >
              {title}
            </div>
          </div>
        ),
        {
          width: 1200,
          height: 630,
        },
      );
    } catch (e: any) {
      console.log(`${e.message}`);
      return new Response(`Failed to generate the image`, {
        status: 500,
      });
    }
  }